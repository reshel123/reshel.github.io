<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AIç»˜ç”»ç”Ÿæˆå™¨ï¼šè¾“å…¥æç¤ºè¯ï¼Œç”Ÿæˆç²¾ç¾AIå›¾ç‰‡ï¼Œæ”¯æŒä¸‹è½½å’Œåˆ†äº«ã€‚">
    <meta name="theme-color" content="#667eea">
    <link rel="canonical" href="https://289872.xyz/ai/painting">
    <meta property="og:type" content="website">
    <meta property="og:title" content="AIç»˜ç”»ç”Ÿæˆå™¨ - èµ›åšç–¯å­">
    <meta property="og:description" content="æ™ºèƒ½AIç»˜ç”»ï¼Œè®©åˆ›æ„æ— é™å¯èƒ½ã€‚">
    <meta property="og:image" content="/assets/img/aiph.jpg">
    <meta property="og:url" content="/ai/painting">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="preconnect" href="https://qianfan.baidubce.com" crossorigin>
    <link rel="preload" as="image" href="/assets/img/aiph.webp">
    <link rel="prefetch" href="/">
    <link rel="prefetch" href="/ai-chat">
    <title>AIç»˜ç”»ç”Ÿæˆå™¨ - èµ›åšç–¯å­</title>
    <link rel="icon" href="/assets/img/icon.jpg" type="image/jpeg">
    <link rel="shortcut icon" href="/assets/img/icon.jpg" type="image/jpeg">
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* èƒŒæ™¯å›¾ç‰‡æ‡’åŠ è½½ */
        body.loaded {
            background-image: url('/assets/img/aiph.webp');
        }
        
        @supports not (background-image: url('/assets/img/aiph.webp')) {
            body.loaded {
                background-image: url('/assets/img/aiph.jpg');
            }
        }
        
        /* èƒŒæ™¯é®ç½© */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: -1;
        }
        
        .container {
            max-width: 1200px;
            margin: 20px auto;
            min-height: calc(100vh - 40px);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(25px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            opacity: 0;
            animation: fadeIn 1s ease-out 0.5s forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* å¤´éƒ¨æ ·å¼ */
        header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px 20px 0 0;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideDown 1s ease-out;
        }
        
        @keyframes slideDown {
            from { 
                transform: translateY(-50px); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0); 
                opacity: 1; 
            }
        }
        
        header h1 {
            color: #ffffff;
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 1s ease-out 0.2s both;
        }
        
        header p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1em;
            animation: fadeInUp 1s ease-out 0.4s both;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* å¯¼èˆªæŒ‰é’® */
        .nav-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 10;
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            text-decoration: none;
            display: inline-block;
            animation: fadeInUp 1s ease-out 0.6s both;
        }
        
        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        main {
            flex: 1;
            padding: 30px;
            animation: slideUp 1s ease-out 1.4s both;
        }
        
        @keyframes slideUp {
            from { 
                transform: translateY(50px); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0); 
                opacity: 1; 
            }
        }
        
        /* æç¤ºè¯è¾“å…¥åŒºåŸŸ */
        .prompt-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 1s ease-out 0.8s both;
        }
        
        .prompt-section h2 {
            color: #ffffff;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .prompt-input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .prompt-input {
            flex: 1;
            min-width: 300px;
            padding: 15px 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .prompt-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .prompt-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            min-width: 120px;
        }
        
        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* ç”Ÿæˆé€‰é¡¹ */
        .generation-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .option-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .option-group label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-weight: 500;
        }
        
        .option-group select,
        .option-group input {
            padding: 10px 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        
        .option-group select option {
            background: #2c3e50;
            color: white;
        }
        
        /* ç”ŸæˆçŠ¶æ€æ˜¾ç¤º */
        .generation-status {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 20px;
            display: none;
        }
        
        .generation-status.active {
            display: block;
            animation: fadeInUp 0.5s ease-out;
        }
        
        .status-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        /* å›¾ç‰‡å±•ç¤ºåŒºåŸŸ */
        .image-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 1s ease-out 1s both;
        }
        
        .image-section h2 {
            color: #ffffff;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 20px;
        }
        
        .image-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
                 .generated-image {
             width: 100%;
             height: 250px;
             object-fit: cover;
             border-radius: 10px;
             margin-bottom: 15px;
             background: rgba(255, 255, 255, 0.1);
             display: flex;
             align-items: center;
             justify-content: center;
             color: rgba(255, 255, 255, 0.6);
             font-size: 14px;
             transition: all 0.3s ease;
             position: relative;
         }
         
         .generated-image:hover {
             transform: scale(1.02);
             box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
         }
         
         .generated-image::after {
             content: 'ğŸ‘ï¸ ç‚¹å‡»é¢„è§ˆ';
             position: absolute;
             top: 50%;
             left: 50%;
             transform: translate(-50%, -50%);
             background: rgba(0, 0, 0, 0.7);
             color: white;
             padding: 8px 16px;
             border-radius: 20px;
             font-size: 12px;
             opacity: 0;
             transition: opacity 0.3s ease;
             pointer-events: none;
         }
         
         .generated-image:hover::after {
             opacity: 1;
         }
        
        .image-info {
            margin-bottom: 15px;
        }
        
        .image-prompt {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .image-meta {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }
        
        .image-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .download-btn {
            background: rgba(76, 175, 80, 0.3);
            color: white;
            border: 1px solid rgba(76, 175, 80, 0.5);
        }
        
                 .download-btn:hover {
             background: rgba(76, 175, 80, 0.4);
             transform: translateY(-2px);
         }
         
         .download-btn.downloading {
             background: rgba(76, 175, 80, 0.6);
             pointer-events: none;
         }
         
         .download-btn.downloading::after {
             content: '';
             display: inline-block;
             width: 12px;
             height: 12px;
             border: 2px solid rgba(255, 255, 255, 0.3);
             border-radius: 50%;
             border-top-color: white;
             animation: spin 1s linear infinite;
             margin-left: 8px;
         }
        
        
        
        .delete-btn {
            background: rgba(244, 67, 54, 0.3);
            color: white;
            border: 1px solid rgba(244, 67, 54, 0.5);
        }
        
                 .delete-btn:hover {
             background: rgba(244, 67, 54, 0.4);
             transform: translateY(-2px);
         }
         
         .copy-btn {
             background: rgba(156, 39, 176, 0.3);
             color: white;
             border: 1px solid rgba(156, 39, 176, 0.5);
         }
         
         .copy-btn:hover {
             background: rgba(156, 39, 176, 0.4);
             transform: translateY(-2px);
         }
         

        
        /* é¢„è§ˆæ¨¡æ€æ¡† */
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .preview-modal.show {
            opacity: 1;
        }
        
        .preview-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            max-width: 90%;
            max-height: 90%;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .preview-modal.show .preview-content {
            transform: translate(-50%, -50%) scale(1);
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .preview-close {
            position: absolute;
            top: 20px;
            right: 30px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .preview-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .preview-actions {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            display: flex;
            gap: 15px;
            opacity: 0;
            transition: all 0.3s ease 0.2s;
        }
        
        .preview-modal.show .preview-actions {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        .preview-action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .preview-action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .empty-state p {
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            header {
                padding: 20px;
            }
            
            header h1 {
                font-size: 2em;
            }
            
            main {
                padding: 20px;
            }
            
            .prompt-input-group {
                flex-direction: column;
            }
            
            .prompt-input {
                min-width: auto;
            }
            
            .generation-options {
                grid-template-columns: 1fr;
            }
            
            .image-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                position: relative;
                top: auto;
                right: auto;
                justify-content: center;
                margin-top: 20px;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* æµ®åŠ¨ç²’å­æ•ˆæœ */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }
        
                 @keyframes float {
             0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0; }
             50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
         }
         
         /* å¤åˆ¶æˆåŠŸæç¤ºåŠ¨ç”» */
         @keyframes slideInRight {
             from { transform: translateX(100%); opacity: 0; }
             to { transform: translateX(0); opacity: 1; }
         }
         
         @keyframes slideOutRight {
             from { transform: translateX(0); opacity: 1; }
             to { transform: translateX(100%); opacity: 0; }
         }
         

        
        /* é¡µè„š */
        footer {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
            border-radius: 0 0 20px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideUp 1s ease-out 0.6s both;
        }
    </style>
</head>
<body>
    <!-- æµ®åŠ¨ç²’å­ -->
    <div class="particles" id="particles"></div>
    
    <div class="container">
        <header>
            <h1>ğŸ¨ AIç»˜ç”»ç”Ÿæˆå™¨</h1>
            <p>è¾“å…¥æ‚¨çš„åˆ›æ„æè¿°ï¼Œè®©AIä¸ºæ‚¨åˆ›ä½œç²¾ç¾å›¾ç‰‡</p>
            
            <!-- å¯¼èˆªæŒ‰é’® -->
            <div class="nav-buttons">
                <a href="/ai" class="nav-btn">ğŸ’¬ AIèŠå¤©</a>
                <a href="/" class="nav-btn">ğŸ  è¿”å›é¦–é¡µ</a>
            </div>
        </header>
        
        <main>
            <!-- æç¤ºè¯è¾“å…¥åŒºåŸŸ -->
            <div class="prompt-section">
                <h2>âœ¨ åˆ›ä½œæç¤º</h2>
                <div class="prompt-input-group">
                    <input type="text" class="prompt-input" id="promptInput" 
                           placeholder="æè¿°æ‚¨æƒ³è¦ç”Ÿæˆçš„å›¾ç‰‡ï¼Œä¾‹å¦‚ï¼šä¸€åªå¯çˆ±çš„å°çŒ«åœ¨èŠ±å›­é‡Œç©è€ï¼Œé˜³å…‰æ˜åªšï¼Œæ²¹ç”»é£æ ¼" 
                           maxlength="1000"> <!-- æ™ºè°±AIæ”¯æŒ1000å­—ç¬¦ -->
                    <button class="generate-btn" id="generateBtn" onclick="generateImage()">
                        <span class="loading-spinner" id="loadingSpinner" style="display: none;"></span>
                        ğŸ¨ ç”Ÿæˆå›¾ç‰‡
                    </button>
                </div>
                
                <!-- ç”Ÿæˆé€‰é¡¹ -->
                <div class="generation-options">
                    <div class="option-group">
                        <label for="modelSelect">æ¨¡å‹é€‰æ‹©</label>
                        <select id="modelSelect">
                                                    <option value="cogview-4-250304">CogView-4 (æ¨è)</option>
                        <option value="cogview-4">CogView-4 æ ‡å‡†ç‰ˆ</option>
                        <option value="cogview-3-flash">CogView-3 Flash (å¿«é€Ÿ)</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label for="imageSize">å›¾ç‰‡å°ºå¯¸</label>
                        <select id="imageSize">
                                                    <option value="1024x1024">1024Ã—1024 (æ­£æ–¹å½¢)</option>
                        <option value="768x1344">768Ã—1344 (ç«–ç‰ˆ)</option>
                        <option value="1344x768">1344Ã—768 (æ¨ªç‰ˆ)</option>
                        <option value="1440x720">1440Ã—720 (å®½å±)</option>
                        <option value="720x1440">720Ã—1440 (ç«–å±)</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label for="imageCount">ç”Ÿæˆæ•°é‡</label>
                        <select id="imageCount">
                                                    <option value="1">1å¼ </option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- ç”ŸæˆçŠ¶æ€æ˜¾ç¤º -->
            <div class="generation-status" id="generationStatus">
                <div class="status-text" id="statusText">æ­£åœ¨ç”Ÿæˆæ‚¨çš„åˆ›æ„å›¾ç‰‡...</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div id="statusDetails">è¯·è€å¿ƒç­‰å¾…ï¼ŒAIæ­£åœ¨åˆ›ä½œä¸­...</div>
            </div>
            
            <!-- å›¾ç‰‡å±•ç¤ºåŒºåŸŸ -->
            <div class="image-section">
                <h2>ğŸ–¼ï¸ ç”Ÿæˆçš„ä½œå“</h2>
                <div id="imageGrid" class="image-grid">
                    <div class="empty-state">
                        <h3>ğŸ¨ å¼€å§‹æ‚¨çš„åˆ›ä½œä¹‹æ—…</h3>
                        <p>åœ¨ä¸Šæ–¹è¾“å…¥æ‚¨çš„åˆ›æ„æè¿°ï¼Œç‚¹å‡»ç”ŸæˆæŒ‰é’®ï¼ŒAIå°†ä¸ºæ‚¨åˆ›ä½œç‹¬ç‰¹çš„å›¾ç‰‡ä½œå“</p>
                    </div>
                </div>
            </div>
        </main>
        
        <footer>
            <p>Â© 2025 | AIç»˜ç”»ç”Ÿæˆå™¨ | ä½œè€…ï¼šé»„é‡‘æ ‘</p>
        </footer>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let generatedImages = [];
        let isGenerating = false;
        
        // æ™ºè°±AI APIé…ç½®
        const AI_PAINTING_CONFIG = {
            apiKey: '91e5f3cf5d9d4679be6c2f053120fdc2.HICxUiT9Zjh7kh2t', // æ‚¨çš„æ™ºè°±AI API Key
            endpoint: 'https://open.bigmodel.cn/api/paas/v4/images/generations', // æ™ºè°±AIçš„å›¾åƒç”Ÿæˆæ¥å£
        };
        
        // æ™ºè°±AI APIé‰´æƒå‡½æ•°
        async function getZhipuAccessToken() {
            return AI_PAINTING_CONFIG.apiKey;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®è¿”å›æ ‡è®°ï¼Œç”¨äºä¼˜åŒ–é¦–é¡µåŠ è½½
            sessionStorage.setItem('returningFromOtherPage', 'true');
            
            initializePage();
            createParticles();
        });
        
        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            // å¿«é€Ÿåˆå§‹åŒ–æ ¸å¿ƒåŠŸèƒ½
            loadSavedImages(); // åŠ è½½å·²ä¿å­˜çš„å›¾ç‰‡
            setupEventListeners(); // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            
            // å¼‚æ­¥åŠ è½½èƒŒæ™¯å›¾ç‰‡ï¼Œä¸é˜»å¡é¡µé¢äº¤äº’
            setTimeout(() => {
                preloadBackgroundImage();
            }, 100);
            
            // åˆå§‹æ¸²æŸ“ä¸€æ¬¡ï¼Œç¡®ä¿ç©ºçŠ¶æ€æ˜¾ç¤ºæ­£ç¡®
            if (generatedImages.length === 0) {
                renderImageGrid();
            }
            // æ ¹æ®åˆå§‹æ¨¡å‹è®¾ç½®maxlength
            updatePromptMaxLength();
        }
        
        // é¢„åŠ è½½èƒŒæ™¯å›¾ç‰‡
        function preloadBackgroundImage() {
            const webpImage = '/assets/img/aiph.webp';
            const jpgImage = '/assets/img/aiph.jpg';
            
            // ä¼˜å…ˆå°è¯•WebPæ ¼å¼
            const img = new Image();
            img.onload = function() {
                document.body.classList.add('loaded');
                console.log('èƒŒæ™¯å›¾ç‰‡åŠ è½½å®Œæˆ:', webpImage);
            };
            img.onerror = function() {
                // WebPåŠ è½½å¤±è´¥ï¼Œå›é€€åˆ°JPG
                const jpgImg = new Image();
                jpgImg.onload = function() {
                    document.body.classList.add('loaded');
                    console.log('èƒŒæ™¯å›¾ç‰‡åŠ è½½å®Œæˆ:', jpgImage);
                };
                jpgImg.onerror = function() {
                    console.log('èƒŒæ™¯å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ¸å˜èƒŒæ™¯');
                };
                jpgImg.src = jpgImage;
            };
            img.src = webpImage;
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æç¤ºè¯è¾“å…¥æ¡†å›è½¦é”®ç”Ÿæˆ
            const promptInput = document.getElementById('promptInput');
            promptInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !isGenerating && !e.shiftKey) { // é¿å…Shift+Enteræ¢è¡Œä¹Ÿè§¦å‘
                    e.preventDefault(); // é˜»æ­¢é»˜è®¤çš„å›è½¦è¡Œä¸º
                    generateImage();
                }
            });
            
            // æ¨¡å‹é€‰æ‹©å˜åŒ–æ—¶æ›´æ–°promptçš„maxlength
            document.getElementById('modelSelect').addEventListener('change', updatePromptMaxLength);

            // æç¤ºè¯è¾“å…¥æ¡†å®æ—¶å­—æ•°ç»Ÿè®¡
            promptInput.addEventListener('input', function() {
                const maxLength = parseInt(this.getAttribute('maxlength'));
                const currentLength = this.value.length;
                // è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ ä¸€ä¸ªå­—æ•°æ˜¾ç¤ºå…ƒç´ ï¼Œä½†ç›®å‰æ ·å¼ä¸­æ²¡æœ‰ç›´æ¥çš„charCountå…ƒç´ ï¼Œåªæ˜¯é€šè¿‡è¾¹æ¡†é¢œè‰²å˜åŒ–æ¥æç¤º
                if (currentLength > maxLength * 0.8) {
                    this.style.borderColor = currentLength > maxLength ? '#ff6b6b' : '#ffa726';
                } else {
                    this.style.borderColor = 'rgba(255, 255, 255, 0.3)';
                }
            });
        }

        // æ ¹æ®æ‰€é€‰æ¨¡å‹æ›´æ–°æç¤ºè¯è¾“å…¥æ¡†çš„æœ€å¤§é•¿åº¦
        function updatePromptMaxLength() {
            const modelSelect = document.getElementById('modelSelect');
            const promptInput = document.getElementById('promptInput');
            const selectedModel = modelSelect.value;
            let maxLength = 500; // é»˜è®¤å€¼ï¼Œä»¥é˜²ä¸‡ä¸€

            if (selectedModel === 'cogview-4-250304') {
                maxLength = 1000;
            } else if (selectedModel === 'cogview-4') {
                maxLength = 1000;
            } else if (selectedModel === 'cogview-3-flash') {
                maxLength = 1000;
            }
            promptInput.setAttribute('maxlength', maxLength);
            // ç¡®ä¿å½“å‰æ–‡æœ¬æ²¡æœ‰è¶…å‡ºæ–°çš„maxLength
            if (promptInput.value.length > maxLength) {
                promptInput.value = promptInput.value.substring(0, maxLength);
            }
            // è§¦å‘ä¸€æ¬¡inputäº‹ä»¶ä»¥æ›´æ–°è¾¹æ¡†é¢œè‰²ç­‰æ ·å¼
            promptInput.dispatchEvent(new Event('input'));
        }
        
        // ç”Ÿæˆå›¾ç‰‡ä¸»å‡½æ•°
        async function generateImage() {
            if (isGenerating) {
                return;
            }
            
            const promptInput = document.getElementById('promptInput');
            const prompt = promptInput.value.trim();
            const currentMaxLength = parseInt(promptInput.getAttribute('maxlength'));
            
            if (!prompt) {
                alert('è¯·è¾“å…¥å›¾ç‰‡æè¿°');
                promptInput.focus();
                return;
            }
            
            if (prompt.length > currentMaxLength) {
                alert(`æè¿°æ–‡å­—ä¸èƒ½è¶…è¿‡${currentMaxLength}ä¸ªå­—ç¬¦`);
                return;
            }
            
            // å¼€å§‹ç”Ÿæˆ
            isGenerating = true;
            showGenerationStatus(true);
            updateStatusText('æ­£åœ¨å‡†å¤‡ç”Ÿæˆ...');
            updateProgress(0); // é‡ç½®è¿›åº¦æ¡
            
            try {
                // è·å–ç”Ÿæˆå‚æ•°
                const params = getGenerationParams(prompt);
                
                let imageResult;
                
                // ä½¿ç”¨æ™ºè°±AI API
                updateStatusText('æ­£åœ¨è°ƒç”¨æ™ºè°±AIç”Ÿæˆå›¾ç‰‡...');
                imageResult = await callZhipuAIAPI(params);
                
                if (!imageResult.success || !imageResult.imageUrl) {
                    throw new Error('å›¾ç‰‡ç”Ÿæˆå¤±è´¥æˆ–æœªè¿”å›å›¾ç‰‡URL');
                }
                
                // ç”ŸæˆæˆåŠŸ
                const generatedImage = {
                    id: Date.now(),
                    prompt: prompt,
                    imageUrl: imageResult.imageUrl,
                    timestamp: new Date().toLocaleString(),
                    params: { // åªä¿å­˜æ™ºè°±AI APIå®é™…ä½¿ç”¨çš„å‚æ•°
                        model: document.getElementById('modelSelect').value,
                        size: document.getElementById('imageSize').value,
                        count: parseInt(document.getElementById('imageCount').value),
                    },
                    taskId: imageResult.taskId
                };
                
                // æ·»åŠ åˆ°å›¾ç‰‡åˆ—è¡¨
                generatedImages.unshift(generatedImage);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveImagesToStorage();
                
                // æ›´æ–°æ˜¾ç¤º
                renderImageGrid();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                updateStatusText('å›¾ç‰‡ç”ŸæˆæˆåŠŸï¼');
                promptInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
                promptInput.style.borderColor = 'rgba(255, 255, 255, 0.3)'; // æ¢å¤è¾¹æ¡†é¢œè‰²
                setTimeout(() => {
                    showGenerationStatus(false);
                }, 2000);
                
                         } catch (error) {
                 console.error('ç”Ÿæˆå¤±è´¥:', error);
                 const errorMessage = error.message || 'æœªçŸ¥é”™è¯¯';
                 
                 // æ ¹æ®é”™è¯¯ç±»å‹æä¾›å…·ä½“çš„è§£å†³å»ºè®®
                 let solutionTips = '';
                 if (errorMessage.includes('429') || errorMessage.includes('Too Many Requests')) {
                     solutionTips = 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•æˆ–æ£€æŸ¥APIé…é¢';
                 } else if (errorMessage.includes('API Key') || errorMessage.includes('Authorization')) {
                     solutionTips = 'APIå¯†é’¥æ— æ•ˆï¼Œè¯·æ£€æŸ¥é…ç½®';
                 } else if (errorMessage.includes('ç½‘ç»œ') || errorMessage.includes('fetch')) {
                     solutionTips = 'ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®';
                 } else if (errorMessage.includes('CORS') || errorMessage.includes('è·¨åŸŸ')) {
                     solutionTips = 'è·¨åŸŸè®¿é—®é™åˆ¶ï¼Œè¯·æ£€æŸ¥APIé…ç½®';
                 } else {
                     solutionTips = 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIé…ç½®';
                 }
                 
                 // ç«‹å³é‡ç½®è¿›åº¦æ¡
                 updateProgress(0);
                 
                 // åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯æç¤º
                 updateStatusText(`âŒ ç”Ÿæˆå¤±è´¥ï¼š${errorMessage}`);
                 
                 // æ›´æ–°çŠ¶æ€è¯¦æƒ…ï¼Œæ˜¾ç¤ºè§£å†³å»ºè®®
                 const statusDetails = document.getElementById('statusDetails');
                 if (statusDetails) {
                     statusDetails.innerHTML = `
                         <div style="color: #ff6b6b; margin-bottom: 10px; font-weight: 600;">
                             ğŸ’¡ è§£å†³å»ºè®®ï¼š${solutionTips}
                         </div>
                         <div style="color: rgba(255, 255, 255, 0.8); font-size: 14px; text-align: left; line-height: 1.6;">
                             ğŸ”§ è¯·æ£€æŸ¥ï¼š<br>
                             â€¢ ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸<br>
                             â€¢ API Key æ˜¯å¦æœ‰æ•ˆ<br>
                             â€¢ æç¤ºè¯æ˜¯å¦ç¬¦åˆè¦æ±‚<br>
                             â€¢ æ˜¯å¦è¶…å‡ºAPIè°ƒç”¨é™åˆ¶<br>
                             â€¢ æ¨¡å‹é€‰æ‹©æ˜¯å¦æ­£ç¡®
                         </div>
                     `;
                 }
                 
                                   // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€ï¼ŒæŒ‰é’®æ˜¾ç¤º"ç”Ÿæˆå¤±è´¥"
                  showGenerationStatus(true, true);
                  
                  // 3ç§’åè‡ªåŠ¨éšè—é”™è¯¯çŠ¶æ€ï¼Œè®©ç”¨æˆ·é‡æ–°å°è¯•
                  setTimeout(() => {
                      showGenerationStatus(false);
                  }, 3000);
            } finally {
                isGenerating = false;
            }
        }
        
        // è·å–ç”Ÿæˆå‚æ•°
        function getGenerationParams(prompt) {
            return {
                prompt: prompt,
                model: document.getElementById('modelSelect').value,
                size: document.getElementById('imageSize').value,
                count: parseInt(document.getElementById('imageCount').value),
                timestamp: new Date().toISOString()
            };
        }
        
        // è°ƒç”¨æ™ºè°±AI APIç”Ÿæˆå›¾ç‰‡
        async function callZhipuAIAPI(params) {
            try {
                const url = AI_PAINTING_CONFIG.endpoint;
                const apiKey = await getZhipuAccessToken();
                const authorizationHeader = `Bearer ${apiKey}`;
                
                // æ„å»ºæ™ºè°±AIè¯·æ±‚å‚æ•°
                const requestBody = {
                    model: params.model,
                    prompt: params.prompt,
                    size: params.size,
                    quality: params.model === 'cogview-4-250304' ? 'standard' : undefined,
                    user_id: 'user_' + Date.now() // ç”Ÿæˆå”¯ä¸€ç”¨æˆ·ID
                };
                
                // æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°
                const progressSteps = ['åˆ†ææç¤ºè¯...', 'AIæ„æ€ä¸­...', 'å¼€å§‹ç”Ÿæˆ...', 'ç»†èŠ‚æ¸²æŸ“...', 'ç­‰å¾…APIå“åº”...'];
                let currentProgress = 0;
                const interval = setInterval(() => {
                    if (currentProgress < 90) { // æ¨¡æ‹Ÿåˆ°90%ç­‰å¾…çœŸå®APIå“åº”
                        currentProgress += 5;
                        updateProgress(currentProgress);
                        updateStatusText(progressSteps[Math.floor(currentProgress / 20)] || 'æ­£åœ¨å¤„ç†...');
                    } else {
                        clearInterval(interval);
                    }
                }, 500);

                // è°ƒç”¨API
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': authorizationHeader
                    },
                    body: JSON.stringify(requestBody)
                });
                
                clearInterval(interval); // åœæ­¢æ¨¡æ‹Ÿè¿›åº¦
                updateProgress(95); // ç¡®ä¿åœ¨APIå“åº”å‰è¾¾åˆ°é«˜è¿›åº¦

                if (!response.ok) {
                    const errorData = await response.json();
                    if (response.status === 429) {
                        throw new Error(`APIè°ƒç”¨å¤±è´¥ï¼šè¯·æ±‚è¿‡äºé¢‘ç¹ï¼ˆ429 Too Many Requestsï¼‰ã€‚è¯·æ£€æŸ¥æ‚¨çš„API Keyé…é¢æˆ–ç¨åå†è¯•ã€‚é”™è¯¯ä¿¡æ¯ï¼š${errorData.error_msg || 'æœªçŸ¥'}`);
                    } else {
                        throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status} - ${errorData.error_msg || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                }
                
                const data = await response.json();
                
                if (data.error_code) {
                    throw new Error(`æ™ºè°±AIé”™è¯¯: ${data.error_msg}`);
                }
                
                if (!data.data || data.data.length === 0 || !data.data[0].url) {
                    throw new Error('APIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯æˆ–æœªè¿”å›å›¾ç‰‡URL');
                }
                
                // è¿”å›ç”Ÿæˆçš„å›¾ç‰‡æ•°æ®
                updateProgress(100); // å®Œæˆè¿›åº¦
                return {
                    success: true,
                    imageUrl: data.data[0].url,
                    taskId: data.id || 'zhipu_' + Date.now() // æ™ºè°±AIè¿”å›çš„æ˜¯idï¼Œå¦‚æœæ²¡æœ‰åˆ™ç”Ÿæˆä¸€ä¸ª
                };
                
            } catch (error) {
                console.error('æ™ºè°±AI APIè°ƒç”¨å¤±è´¥:', error);
                throw error;
            }
        }
        
        // æ¨¡æ‹Ÿå›¾ç‰‡ç”Ÿæˆè¿‡ç¨‹ï¼ˆå½“APIæœªé…ç½®æ—¶ä½¿ç”¨ï¼‰
        async function simulateImageGeneration(params) {
            const steps = [
                'æ­£åœ¨åˆ†ææ‚¨çš„æè¿°...',
                'AIæ­£åœ¨æ„æ€åˆ›æ„...',
                'æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...',
                'æ­£åœ¨ä¼˜åŒ–ç»†èŠ‚...',
                'å³å°†å®Œæˆ...'
            ];
            
            for (let i = 0; i < steps.length; i++) {
                updateStatusText(steps[i]);
                updateProgress((i + 1) / steps.length * 100);
                await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 400));
            }
            
            updateProgress(100);
            updateStatusText('ç”Ÿæˆå®Œæˆï¼');
        }
        
        // æ˜¾ç¤º/éšè—ç”ŸæˆçŠ¶æ€
        function showGenerationStatus(show, isError = false) {
            const statusElement = document.getElementById('generationStatus');
            const generateBtn = document.getElementById('generateBtn');
            const loadingSpinner = generateBtn.querySelector('.loading-spinner');
            
            if (show && !isError) {
                // æ­£å¸¸ç”ŸæˆçŠ¶æ€
                statusElement.classList.add('active');
                generateBtn.disabled = true;
                if (loadingSpinner) loadingSpinner.style.display = 'inline-block';
                generateBtn.innerHTML = `<span class="loading-spinner"></span> ç”Ÿæˆä¸­...`;
            } else if (show && isError) {
                // é”™è¯¯çŠ¶æ€
                statusElement.classList.add('active');
                generateBtn.disabled = false;
                if (loadingSpinner) loadingSpinner.style.display = 'none';
                generateBtn.innerHTML = 'âŒ ç”Ÿæˆå¤±è´¥';
            } else {
                // éšè—çŠ¶æ€ï¼Œæ¢å¤æ­£å¸¸
                statusElement.classList.remove('active');
                generateBtn.disabled = false;
                if (loadingSpinner) loadingSpinner.style.display = 'none';
                generateBtn.innerHTML = 'ğŸ¨ ç”Ÿæˆå›¾ç‰‡';
                
                // å®Œå…¨é‡ç½®æ‰€æœ‰çŠ¶æ€
                updateProgress(0);
                updateStatusText('æ­£åœ¨ç”Ÿæˆæ‚¨çš„åˆ›æ„å›¾ç‰‡...');
                
                // é‡ç½®çŠ¶æ€è¯¦æƒ…ä¸ºé»˜è®¤æ–‡æœ¬
                const statusDetails = document.getElementById('statusDetails');
                if (statusDetails) {
                    statusDetails.innerHTML = 'è¯·è€å¿ƒç­‰å¾…ï¼ŒAIæ­£åœ¨åˆ›ä½œä¸­...';
                }
                
                // ç¡®ä¿ç”ŸæˆçŠ¶æ€å®Œå…¨é‡ç½®
                isGenerating = false;
            }
        }
        
        // æ›´æ–°çŠ¶æ€æ–‡æœ¬
        function updateStatusText(text) {
            const statusText = document.getElementById('statusText');
            statusText.textContent = text;
        }
        
        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percentage) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percentage + '%';
        }
        
        // æ¸²æŸ“å›¾ç‰‡ç½‘æ ¼
        function renderImageGrid() {
            const imageGrid = document.getElementById('imageGrid');
            
            if (generatedImages.length === 0) {
                imageGrid.innerHTML = `
                    <div class="empty-state">
                        <h3>ğŸ¨ å¼€å§‹æ‚¨çš„åˆ›ä½œä¹‹æ—…</h3>
                        <p>åœ¨ä¸Šæ–¹è¾“å…¥æ‚¨çš„åˆ›æ„æè¿°ï¼Œç‚¹å‡»ç”ŸæˆæŒ‰é’®ï¼ŒAIå°†ä¸ºæ‚¨åˆ›ä½œç‹¬ç‰¹çš„å›¾ç‰‡ä½œå“</p>
                    </div>
                `;
                return;
            }
            
            imageGrid.innerHTML = generatedImages.map(image => `
                <div class="image-card">
                                         <img src="${image.imageUrl}" alt="AIç”Ÿæˆçš„å›¾ç‰‡" class="generated-image" 
                          onclick="previewImage('${image.imageUrl}')" 
                          style="cursor: pointer;"
                          onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="generated-image fallback-image" style="display: none; flex-direction: column; align-items: center; justify-content: center;">
                        <div>ğŸš«</div>
                        <div>å›¾ç‰‡åŠ è½½å¤±è´¥</div>
                        <div style="font-size: 10px; margin-top: 5px;">è¯·å°è¯•é‡æ–°ä¸‹è½½æˆ–ç”Ÿæˆ</div>
                    </div>
                    <div class="image-info">
                        <div class="image-prompt">${image.prompt}</div>
                        <div class="image-meta">
                            <span>${image.timestamp}</span>
                            <span>${image.params.size} / ${image.params.model}</span>
                        </div>
                    </div>
                                                                                   <div class="image-actions">
                          <button class="action-btn download-btn" onclick="downloadImageFile('${image.imageUrl}', 'AIç»˜ç”»_${image.timestamp}.png', this)" title="ä¸‹è½½å›¾ç‰‡">
                              ğŸ“¥ ä¸‹è½½
                          </button>
                          <button class="action-btn delete-btn" onclick="deleteImage(${image.id})">
                              ğŸ—‘ï¸ åˆ é™¤
                          </button>
                      </div>
                </div>
            `).join('');
        }
        
                                                     // ä¸‹è½½å›¾ç‰‡æ–‡ä»¶ï¼ˆé™é»˜ä¸‹è½½ï¼Œæ— å¼¹çª—ï¼‰
           async function downloadImageFile(imageUrl, filename, buttonElement = null) {
               console.log('å¼€å§‹ä¸‹è½½å›¾ç‰‡:', imageUrl);
               
               // å¦‚æœæä¾›äº†æŒ‰é’®å…ƒç´ ï¼Œæ˜¾ç¤ºä¸‹è½½çŠ¶æ€
               if (buttonElement) {
                   buttonElement.classList.add('downloading');
                   buttonElement.textContent = 'ğŸ“¥ ä¸‹è½½ä¸­...';
               }
               
               try {
                   // ä½¿ç”¨fetchä¸‹è½½æ–‡ä»¶
                   const response = await fetch(imageUrl, {
                       mode: 'cors',
                       cache: 'no-cache'
                   });
                   
                   if (!response.ok) {
                       throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);
                   }
                   
                   const imageBlob = await response.blob();
                   const url = window.URL.createObjectURL(imageBlob);
                   
                   const link = document.createElement('a');
                   link.href = url;
                   link.download = filename;
                   link.style.display = 'none'; // éšè—é“¾æ¥å…ƒç´ 
                   document.body.appendChild(link);
                   link.click();
                   document.body.removeChild(link);
                   
                   // æ¸…ç†URLå¯¹è±¡
                   window.URL.revokeObjectURL(url);
                   
                   console.log('å›¾ç‰‡ä¸‹è½½æˆåŠŸ:', filename);
                   
                   // æ¢å¤æŒ‰é’®çŠ¶æ€
                   if (buttonElement) {
                       setTimeout(() => {
                           buttonElement.classList.remove('downloading');
                           buttonElement.textContent = 'ğŸ“¥ ä¸‹è½½';
                       }, 1000);
                   }
                   
               } catch (error) {
                   console.error('ä¸‹è½½å¤±è´¥:', error);
                   
                   // æ¢å¤æŒ‰é’®çŠ¶æ€
                   if (buttonElement) {
                       buttonElement.classList.remove('downloading');
                       buttonElement.textContent = 'ğŸ“¥ ä¸‹è½½';
                   }
                   
                   // å¦‚æœfetchå¤±è´¥ï¼Œé™é»˜å°è¯•ç›´æ¥æ‰“å¼€é“¾æ¥
                   try {
                       console.log('fetchä¸‹è½½å¤±è´¥ï¼Œå°è¯•ç›´æ¥æ‰“å¼€é“¾æ¥...');
                       window.open(imageUrl, '_blank');
                   } catch (directError) {
                       console.error('ç›´æ¥æ‰“å¼€ä¹Ÿå¤±è´¥:', directError);
                       // åªåœ¨å®Œå…¨å¤±è´¥æ—¶æ˜¾ç¤ºä¸€ä¸ªç®€å•çš„æç¤º
                       console.log('ä¸‹è½½å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ä¿å­˜å›¾ç‰‡');
                   }
               }
           }
        

        
        
        
        
        
        // åˆ†äº«å›¾ç‰‡åŠŸèƒ½å·²ç§»é™¤
        function shareImage(imageId) {
            alert('åˆ†äº«åŠŸèƒ½å·²ç§»é™¤ã€‚');
        }
        
        // åˆ é™¤å›¾ç‰‡
        function deleteImage(imageId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—ï¼Ÿ')) {
                generatedImages = generatedImages.filter(img => img.id !== imageId);
                saveImagesToStorage();
                renderImageGrid();
            }
        }
        
        // ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨
        function saveImagesToStorage() {
            try {
                localStorage.setItem('aiPaintingImages', JSON.stringify(generatedImages));
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
            }
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å›¾ç‰‡
        function loadSavedImages() {
            try {
                const saved = localStorage.getItem('aiPaintingImages');
                if (saved) {
                    generatedImages = JSON.parse(saved);
                    renderImageGrid(); // åŠ è½½åç«‹å³æ¸²æŸ“ä¸€æ¬¡
                }
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
            }
        }
        
        // åˆ›å»ºç²’å­æ•ˆæœ
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return;
            
            // å‡å°‘ç²’å­æ•°é‡ä»¥æå‡æ€§èƒ½
            const particleCount = 20;
            
            // ä½¿ç”¨ requestAnimationFrame ä¼˜åŒ–æ¸²æŸ“
            const createParticle = (index) => {
                if (index >= particleCount) return;
                
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particlesContainer.appendChild(particle);
                
                // åˆ†æ‰¹åˆ›å»ºç²’å­ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹
                requestAnimationFrame(() => createParticle(index + 1));
            };
            
            createParticle(0);
        }
        
        // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†ï¼ˆç”¨æˆ·åˆ‡æ¢é¡µé¢æ—¶ä¿æŒç”ŸæˆçŠ¶æ€ï¼‰
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                console.log('é¡µé¢éšè—ï¼Œä½†ç”Ÿæˆè¿‡ç¨‹ç»§ç»­...');
                // é¡µé¢éšè—æ—¶æš‚åœç²’å­åŠ¨ç”»ä»¥èŠ‚çœèµ„æº
                const particles = document.querySelectorAll('.particle');
                particles.forEach(particle => {
                    particle.style.animationPlayState = 'paused';
                });
            } else {
                console.log('é¡µé¢é‡æ–°å¯è§');
                // é¡µé¢å¯è§æ—¶æ¢å¤ç²’å­åŠ¨ç”»
                const particles = document.querySelectorAll('.particle');
                particles.forEach(particle => {
                    particle.style.animationPlayState = 'running';
                });
            }
        });
        
        // é¡µé¢å¸è½½å‰æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', function() {
            // æ¸…ç†å¯èƒ½çš„å†…å­˜æ³„æ¼
            generatedImages = [];
            if (window.particleInterval) {
                clearInterval(window.particleInterval);
            }
        });
        

         
         // å¤åˆ¶å›¾ç‰‡é“¾æ¥åˆ°å‰ªè´´æ¿
         async function copyImageUrl(imageUrl) {
            try {
                await navigator.clipboard.writeText(imageUrl);
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                const successTip = document.createElement('div');
                successTip.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: rgba(76, 175, 80, 0.9);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 25px;
                    font-size: 14px;
                    z-index: 10001;
                    animation: slideInRight 0.3s ease-out;
                `;
                successTip.textContent = 'âœ… å›¾ç‰‡é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
                document.body.appendChild(successTip);
                
                // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
                setTimeout(() => {
                    successTip.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => {
                        if (successTip.parentNode) {
                            successTip.parentNode.removeChild(successTip);
                        }
                    }, 300);
                }, 3000);
                
                console.log('å›¾ç‰‡é“¾æ¥å¤åˆ¶æˆåŠŸ:', imageUrl);
                
            } catch (error) {
                console.error('å¤åˆ¶å¤±è´¥:', error);
                
                // é™çº§åˆ°ä¼ ç»Ÿæ–¹æ³•
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = imageUrl;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    alert('âœ… å›¾ç‰‡é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿\n\né“¾æ¥æœ‰æ•ˆæœŸï¼š24å°æ—¶\nè¯·åœ¨æœ‰æ•ˆæœŸå†…ä½¿ç”¨é“¾æ¥');
                    
                } catch (fallbackError) {
                    console.error('é™çº§å¤åˆ¶ä¹Ÿå¤±è´¥:', fallbackError);
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹é“¾æ¥ï¼š\n\n' + imageUrl);
                }
            }
        }
        
        // é¢„è§ˆå›¾ç‰‡æ¨¡æ€æ¡†
        function previewImage(imageUrl) {
            const modal = document.getElementById('previewModal');
            const previewImg = document.getElementById('previewImage');
            previewImg.src = imageUrl;
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        }
        
        // å…³é—­é¢„è§ˆæ¨¡æ€æ¡†
        function closePreview() {
            const modal = document.getElementById('previewModal');
            modal.classList.remove('show');
            
            // ç­‰å¾…åŠ¨ç”»å®Œæˆåéšè—æ¨¡æ€æ¡†
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto'; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            }, 300);
        }
        
                                   // ä»é¢„è§ˆæ¨¡æ€æ¡†ä¸‹è½½å›¾ç‰‡
          function downloadFromPreview() {
              const previewImg = document.getElementById('previewImage');
              const imageUrl = previewImg.src;
              const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
              const downloadBtn = event.target; // è·å–è¢«ç‚¹å‡»çš„æŒ‰é’®
              downloadImageFile(imageUrl, `AIç»˜ç”»_${timestamp}.png`, downloadBtn);
              // ä¸‹è½½åå…³é—­é¢„è§ˆæ¨¡æ€æ¡†
              setTimeout(() => {
                  closePreview();
              }, 1000);
          }
        
        // ä»é¢„è§ˆæ¨¡æ€æ¡†åˆ†äº«å›¾ç‰‡
        function shareFromPreview() {
            const previewImg = document.getElementById('previewImage');
            const imageUrl = previewImg.src;
            copyImageUrl(imageUrl);
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('previewModal');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closePreview();
                }
            });
            
            // ESCé”®å…³é—­æ¨¡æ€æ¡†
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closePreview();
                }
                // ç©ºæ ¼é”®é¢„è§ˆå½“å‰å›¾ç‰‡ï¼ˆå¦‚æœæ¨¡æ€æ¡†å·²æ‰“å¼€ï¼‰
                if (e.key === ' ' && document.getElementById('previewModal').style.display === 'block') {
                    e.preventDefault();
                    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…¶ä»–åŠŸèƒ½
                }
            });
        });
    </script>
</body>

<!-- é¢„è§ˆæ¨¡æ€æ¡† -->
<div id="previewModal" class="preview-modal">
    <button class="preview-close" onclick="closePreview()">Ã—</button>
    <div class="preview-content">
        <img id="previewImage" class="preview-image" src="" alt="é¢„è§ˆå›¾ç‰‡">
    </div>
    <div class="preview-actions">
        <button class="preview-action-btn" onclick="downloadFromPreview()">ğŸ“¥ ä¸‹è½½</button>
        <button class="preview-action-btn" onclick="shareFromPreview()">ğŸ“¤ åˆ†äº«</button>
    </div>
</div>
</html>
